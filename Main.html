<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Roblox Luau Playground</title>
<style>
body{margin:0;background:#0b0f1a;color:#e8ebff;font-family:system-ui,Arial}
#top{display:flex;gap:8px;padding:10px;background:#12172a}
textarea{flex:1;height:200px;background:#0f1426;color:#e8ebff;border:1px solid #2a3160;border-radius:10px;padding:10px;font-family:monospace;font-size:14px}
button{background:#7c9cff;border:none;border-radius:10px;padding:10px 16px;font-weight:600;cursor:pointer}
#out{padding:10px;height:calc(100vh - 230px);overflow:auto;white-space:pre-wrap;font-family:monospace}
.warn{color:#ffb86b}
.error{color:#ff6b6b}
</style>
</head>
<body>
<div id="top">
<textarea id="code">local test = "ok"
Print(test)

local count = 0
while count < 10 do
	count = count + 1
	print(count)
end

local ok = {
	Hello = {Name="Test", Password="test"},
	Hello1 = {Name="test1", Password="test1"}
}

print(ok.Hello.Name)</textarea>
<button onclick="run()">Run</button>
</div>
<div id="out"></div>

<script>
const out = document.getElementById("out")

function write(text, cls){
	const d = document.createElement("div")
	if(cls) d.className = cls
	d.textContent = text
	out.appendChild(d)
	out.scrollTop = out.scrollHeight
}

function sleep(ms){ return new Promise(r=>setTimeout(r,ms)) }

async function run(){
	out.textContent = ""
	try{
		let code = document.getElementById("code").value.replace(/\r/g,"")
		let lines = code.split("\n")
		let vars = {}

		async function exec(block){
			for(let i=0;i<block.length;i++){
				let raw = block[i]
				let line = raw.trim()
				if(!line) continue

				let low = line.toLowerCase()

				if(low.startsWith("local ")){
					let p = line.replace(/local /i,"").split("=")
					let k = p[0].trim()
					let right = p.slice(1).join("=").trim()
					if(right.startsWith("{")){
						let {table, end} = parseTable(block, i)
						vars[k] = table
						i = end
					}else{
						vars[k] = evalExpr(right, i+1)
					}
					continue
				}

				if(low.startsWith("print(")){
					let v = evalExpr(line.slice(6,-1), i+1)
					write(String(v))
					continue
				}

				if(low.startsWith("warn(")){
					let v = evalExpr(line.slice(5,-1), i+1)
					write(String(v),"warn")
					continue
				}

				if(low.startsWith("wait(") || low.startsWith("task.wait(")){
					let v = Number(evalExpr(line.includes(".") ? line.slice(10,-1) : line.slice(5,-1), i+1))
					await sleep((isNaN(v)?1:v)*1000)
					continue
				}

				if(low.startsWith("while ")){
					let idx = low.indexOf(" do")
					let cond = line.slice(6,idx)
					let inner = []
					i++
					let depth = 1
					for(;i<block.length;i++){
						let l = block[i].trim().toLowerCase()
						if(l.startsWith("while ")||l.startsWith("for ")) depth++
						if(l=="end") depth--
						if(depth==0) break
						inner.push(block[i])
					}
					while(evalCond(cond, i+1)){
						await exec(inner)
					}
					continue
				}

				if(low.startsWith("for ")){
					let m = line.match(/for\s+(\w+)\s*=\s*(.+)\s*,\s*(.+)\s+do/i)
					let vname = m[1]
					let start = Number(evalExpr(m[2], i+1))
					let end = Number(evalExpr(m[3], i+1))
					let inner = []
					i++
					let depth = 1
					for(;i<block.length;i++){
						let l = block[i].trim().toLowerCase()
						if(l.startsWith("while ")||l.startsWith("for ")) depth++
						if(l=="end") depth--
						if(depth==0) break
						inner.push(block[i])
					}
					for(let v=start;v<=end;v++){
						vars[vname]=v
						await exec(inner)
					}
					continue
				}

				if(line.includes("=")){
					let p = line.split("=")
					let k = p[0].trim()
					let v = evalExpr(p.slice(1).join("=").trim(), i+1)
					vars[k]=v
					continue
				}

				throw new Error("Line "+(i+1)+": Unknown statement")
			}
		}

		function parseTable(block, start){
			let obj = {}
			let i = start
			for(i=start+1;i<block.length;i++){
				let l = block[i].trim()
				if(l.startsWith("}")) break
				if(!l) continue
				let [key, val] = l.replace(/,$/,"").split("=")
				key = key.trim()
				val = val.trim()
				if(val.startsWith("{")){
					let inner = {}
					val = val.replace("{","").replace("}","")
					let parts = val.split(",")
					for(let p of parts){
						if(!p.includes("=")) continue
						let [k,v]=p.split("=")
						inner[k.trim()] = evalExpr(v.trim(), i+1)
					}
					obj[key]=inner
				}else{
					obj[key]=evalExpr(val, i+1)
				}
			}
			return {table:obj,end:i}
		}

		function evalExpr(expr, line){
			expr = expr.trim()
			if(expr.includes(".")){
				let parts = expr.split(".")
				let v = vars[parts[0]]
				for(let i=1;i<parts.length;i++) v = v[parts[i]]
				return v
			}
			if(expr.startsWith('"') && expr.endsWith('"')) return expr.slice(1,-1)
			if(expr=="true") return true
			if(expr=="false") return false
			if(!isNaN(Number(expr))) return Number(expr)
			if(expr in vars) return vars[expr]
			throw new Error("Line "+line+": Unknown variable '"+expr+"'")
		}

		function evalCond(cond, line){
			let parts = cond.split("==")
			if(parts.length==2){
				return evalExpr(parts[0], line) == evalExpr(parts[1], line)
			}
			if(cond.includes("<")){
				let p = cond.split("<")
				return evalExpr(p[0],line) < evalExpr(p[1],line)
			}
			return Boolean(evalExpr(cond, line))
		}

		await exec(lines)
	}catch(e){
		write(e.message,"error")
	}
}
</script>
</body>
</html>
